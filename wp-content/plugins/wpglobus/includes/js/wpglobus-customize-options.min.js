jQuery(document).ready(function(e){"use strict";var o={listID:"#wpglobus-sortable",customizeSave:!1,customizeSaveData:"",init:function(){e("#wpglobus-sortable").sortable({update:o.sortUpdate}),o.addListeners(),o.ajaxListener()},addListeners:function(){e("body").on("change",".wpglobus-listen-change",function(e){o.setState(!1)}),e("body").on("change","#wpglobus-sortable input.wpglobus-language-item",function(t){var a=e(this);a.prop("checked")||o.removeLanguage(a)}),e("#customize-control-wpglobus_add_languages_select_box select").on("change",function(e){o.addLanguage(e,this)}),e("#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title").off("click keydown"),e("body").on("click","#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title",function(e){window.open(WPGlobusCustomizeOptions.addonsPage,"_blank")}),e(document).on("click","#"+WPGlobusCustomizeOptions.userControlSaveButton,function(){o.userControlAjax(this)})},removeLanguage:function(o){var t=o.data("language"),a=e("#customize-control-wpglobus_add_languages_select_box select option").eq(0);e('<option value="'+t+'">'+WPGlobusCustomizeOptions.config.language_name[t]+" ("+WPGlobusCustomizeOptions.config.en_language_name[t]+") </option>").insertAfter(a),o.parent("li").remove()},addLanguage:function(t,a){var n=e(a).attr("value"),s=e("#wpglobus-item-skeleton").html(),i="",c=e(o.listID+" li").attr("class");if("select"!=n){i=(i=(i=(i=(i=(i=(i=(i=(i=s.replace("{{flag}}",'src="'+WPGlobusCustomizeOptions.config.flags_url+WPGlobusCustomizeOptions.config.flag[n]+'"')).replace("{{name}}",n)).replace("{{id}}",n)).replace('checked="{{checked}}"','checked="checked"')).replace('disabled="{{disabled}}"',"")).replace("{{item}}",WPGlobusCustomizeOptions.config.en_language_name[n]+" ("+n+") ")).replace("{{order}}","#")).replace("{{language}}",n)).replace("{{edit-link}}",WPGlobusCustomizeOptions.editLink.replace("{{language}}",n)),e('<li class="'+c+'">'+i+"</li>").appendTo(o.listID),o.setOrder();var u=e(a).find("option");e.each(u,function(o,t){e(t).attr("value")==n&&e(t).remove()})}},sortUpdate:function(e,t){o.setState(!1),o.setOrder()},setOrder:function(){e("#wpglobus-sortable input.wpglobus-language-item").each(function(o,t){var a=e(t);0==o?a.prop("disabled","disabled").prop("checked","checked"):a.removeProp("disabled"),a.data("order",o)})},setState:function(e){wp.customize.state("saved").set(e)},getCustomizeSaveData:function(){return o.customizeSaveData},enabledUserControl:function(e){return void 0!==WPGlobusCustomize.controlInstances[e]&&WPGlobusCustomize.controlInstances[e].userControl.enabled},userControlAjax:function(o){e(o).prop("disabled",!0);var t={};t.action="cb-controls-save",t.controls={},e(".wpglobus-customize-cb-control").each(function(o,a){var n=e(a);if(n.prop("checked"));else{var s=n.data("control");s=(s=s.replace("[","{{")).replace("]","}}"),t.controls[s]="disable"}}),e.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:t},dataType:"json"}).always(function(){location.reload(!0)})},ajax:function(t,a){if("wpglobus_customize_save"==t){var n={};n.action="wpglobus_customize_save",n.options={},e.each(WPGlobusCustomizeOptions.settings,function(t,a){e.each(a,function(t,a){if("wpglobus_customize_enabled_languages"==t)return n.options[a.option]={},e("#wpglobus-sortable input.wpglobus-language-item").each(function(o,t){n.options[a.option][e(this).data("language")]="1"}),!0;if(-1!=o.customizeSaveData.indexOf("wpglobus_customize_post_type_")&&-1!=t.indexOf("wpglobus_customize_post_type_"))void 0===n.options[a.option]&&(n.options[a.option]={}),n.options[a.option][t.replace("wpglobus_customize_post_type_","")]=e("#customize-control-"+t+" input").prop("checked")?1:0;else if(-1!=o.customizeSaveData.indexOf(t)){var s=e("#customize-control-"+t+" "+a.type),i="";"textarea"==a.type?i=s.val():"wpglobus_checkbox"==a.type?(s=e("#customize-control-"+t+" input"),i="wpglobus_customize_selector_wp_list_pages"==t?s.prop("checked")?1:0:s.prop("checked")?1:""):"checkbox"==a.type?i=s.prop("checked")?1:"":"select"==a.type&&(i=s.val()),n.options[a.option]=i}})})}e.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:n},dataType:"json"})},getChangesetData:function(o){if(void 0!==o){var t=/customize_changeset_data=([^&]+)/.exec(o);if(void 0===t[1])return;var a,n=decodeURIComponent(t[1]),s=JSON.parse(n);e.each(s,function(e,o){void 0!==WPGlobusCustomize.controlInstances[e]&&(a="",a=(WPGlobusCustomize.controlInstances[e].type,WPGlobusCustomize.controlInstances[e].setting),s[e].value=a)});var i=JSON.stringify(s);i=(i=encodeURIComponent(i)).replace(/%20/g,"+"),o=o.replace(t[1],i)}return o},ajaxListener:function(){e(document).on("ajaxSend",function(e,t,a){void 0!==a.data&&-1!=a.data.indexOf("wp_customize=on")&&-1!=a.data.indexOf("action=customize_save")&&(-1!=a.data.indexOf("customized=")?(o.customizeSave=!0,o.customizeSaveData=a.data):-1!=a.data.indexOf("customize_changeset_data=")&&(a.data=o.getChangesetData(a.data)))}),e(document).on("ajaxComplete",function(e,t,a){void 0!==t.responseText&&o.customizeSave&&(o.customizeSave=!1,o.ajax("wpglobus_customize_save"))}),e(document).on("ajaxStop",function(){o.customizeSave&&(o.customizeSave=!1,o.ajax("wpglobus_customize_save"))})}};WPGlobusCustomizeOptions=e.extend({},WPGlobusCustomizeOptions,o),WPGlobusCustomizeOptions.init()});